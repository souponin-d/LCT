# LCT – Local CTG Toolkit

## Архитектура проекта

```
.
├── backend/              # FastAPI-приложение (пока заглушка)
│   └── app/
│       ├── __init__.py
│       └── main.py       # Эндпоинты health/ingest/stream
├── data/
│   └── archive/          # Папка с архивными данными для эмулятора (пока пусто)
├── emulator/
│   ├── __init__.py
│   └── realtime_emulator.py  # Скрипт для проигрывания архивов в режиме real-time
├── frontend/
│   ├── public/
│   └── src/              # Здесь появится приложение на Svelte
└── docs/                 # Техническая документация/ноутбуки (опционально)
```

## Эмулятор реального времени

`emulator/realtime_emulator.py` читает архивные записи (JSON, JSONL или CSV) и
воспроизводит их партиями (`batch.json`) с указанным интервалом времени.

### Пример запуска

```bash
python -m emulator.realtime_emulator data/archive/sample.json --time-step 500 --batch-size 20 --max-batches 10
```

Параметры:
* `archive` – путь к файлу или директории с архивами.
* `--time-step` – задержка между батчами в миллисекундах.
* `--batch-size` – количество записей в одном батче.
* `--loop` – повторять архив по кругу.
* `--max-batches` – ограничение на число батчей (по умолчанию бесконечно).
* `--output` – файл, куда складывать текущий `batch.json`.

## Backend-заглушка

FastAPI-приложение (`backend/app/main.py`) реализует базовые эндпоинты:

* `GET /health` – проверка живости сервиса.
* `POST /ingest` – приём батча от эмулятора и сохранение его в кольцевой буфер.
* `GET /stream` – выдача последнего принятого батча (будет расширено в будущем).

### Временный анализатор

Файл `backend/main_analyze.py` поднимает отдельное FastAPI-приложение с WebSocket-эндпоинтом
`/ws/analyze`. Эмулятор отправляет в него `batch.json`, а в ответ получает заглушку
`processed_data.json`, которая также выводится в консоль для отладки.

## Frontend

Папка `frontend/` подготовлена для будущего приложения на Svelte. Статические файлы
(`public/`) и исходники (`src/`) будут добавлены на следующих этапах.

## Совместный запуск эмулятора и бэкенда

Оба компонента можно запустить одной командой:

```bash
python main.py -t 500 -b 20
```

Параметры `-t/--time-step` и `-b/--batch-size` передаются эмулятору. При необходимости можно
переопределить адрес бэкенда опциями `--host` и `--port`.
